#!/bin/bash
clear

# Check for Dependacies
type toilet >/dev/null 2>&1 || { sudo apt-get install -y toilet; exit 1; }

# Check for root
function rootcheck() {
if [[ $USER != "root" ]] ; then
                echo "Please Note: This script must be run as root!"
                exit 1
        fi
echo -e " Checking For Root or Sudo: ${g}PASSED${endc}"
}

#Menu Display

function menu() {
echo "	1. Pull DNS Records"
echo "	2. Nmap Ping Sweep"
echo "	3. MS SQL Instance Enum"
echo "	4. Resolve Host names"
echo "	q. Quit"
echo "Choice: "
read choice
}

#Banner
function banner(){
toilet PenScan
echo "$(tput setaf 2)[*]$(tput sgr0) PenScan v1.0 by @InfoSecPS"
echo "$(tput setaf 2)[*]$(tput sgr0) Thanks also to @ZephrFish"
echo "   "
}

#Name Resolver from RTFM

function nameRes(){
clear
banner
echo "Enter class C address: i.e. 192.168.1"
read range
for ip in {1..254..1};do
host $range.$ip | grep "name pointer" | cut -d " " -f5
done > $output/$company/hosts/hostnames.txt
echo "    "
echo " Hostnames for '$range' saved to '$output/$company/hosts/'"
echo "     "
menu
}

#DNS Scan function

function dns_scan() {
clear
banner
echo "$(tput setaf 3)[*]$(tput sgr0) Enter the domain name for DNS query"
read domain
dig $domain ANY +nostat +nocmd +nocomments > $output/$company/dns/dns.txt
echo "     "
echo "$(tput setaf 2)[*]$(tput sgr0) DNS query output to '$output/$company/dns/'"
sleep 2
echo "   "
menu
}

#Nmap Ping sweep function
function ping_sweep() {
clear
banner
touch $output/$company/nmap/hostlist.txt
echo "$(tput setaf 3)[*]$(tput sgr0) Please enter IP/range for Ping Sweep"
        read ip_input
echo $ip_input >> $output/$company/hostlist.txt
echo "$(tput setaf 3)[+]$(tput sgr0) Running Ping sweep on $ip_input"
sleep 1
nmap -sP -iL $output/$company/nmap/hostlist.txt -oG $output/$company/nmap/pingscan > /dev/null
grep Up $output/$company/nmap/pingscan | awk '{print$2}' > $output/$company/nmap/ScanResult/uplist
grep Down $output/$company/nmap/pingscan | awk '{print$2}' > $output/$company/nmap/ScanResult/downlist
echo "     "
echo "$(tput setaf 2)[+]$(tput sgr0) Live hosts from '$ip_input'saved to /root/$company/nmap/"
echo "    "
sleep 1
menu
}

#MSSQL DB Instance Enumeration
function MSSQL(){
clear
banner
echo "$(tput setaf 3)[+]$(tput sgr0) Please enter target IP Address for DB Emumeration."
read sql_ip
echo "    "
echo "$(tput setaf 3)[+]$(tput sgr0) Test may take a few minutes to complete!"
nmap -sS --script=ms-sql-info $sql_ip >> $output/$company/sql/dbenum.txt
echo "    "
echo "$(tput setaf 2)[+]$(tput sgr0) MS SQL Enumeration for '$sql_ip' saved to $output/$company/sql/"
echo "    "
menu
}

rootcheck
banner
echo "$(tput setaf 4)[!]$(tput sgr0) Enter name of Company"
read company
echo "    "
echo "Where would you like to save '$company' files?"
read output
mkdir $output/$company
cd $output/$company
mkdir {dns,sql,nmap,hosts}
cd nmap
mkdir ScanResult
echo "$(tput setaf 2)[*]$(tput sgr0) Directories Created!"
echo "     "
sleep 1
clear
banner
menu


if [ $choice == "1" ]
then
dns_scan
fi

if [ $choice == "2" ]
then
ping_sweep
fi

if [ $choice == "3" ]
then
MSSQL
fi

if [ $choice == "4" ]
then
nameRes
fi

if [ $choice == "q" ]
then
exit
fi
